<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dance Choreography Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="p5.sound.min.js"></script> <!-- Reference to your uploaded file -->
</head>
<body>
    <h1>Dance Choreography Tool</h1>
    <p>Upload a song and choreograph your moves!</p>
    <input type="file" id="fileInput" accept="audio/*">
    <br>
    <button id="playButton">Play</button>
    <canvas id="danceCanvas"></canvas>

    <script>
        let song;
        let dancers = [];

        function setup() {
            createCanvas(600, 400);
            background(240);

            const playButton = select('#playButton');
            playButton.mousePressed(togglePlay);

            let input = document.getElementById('fileInput');
            input.addEventListener('change', handleFileSelect, false);
        }

        function draw() {
            background(240);

            // Draw the dancers
            dancers.forEach(dancer => {
                dancer.display();
                dancer.move();
            });
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    song = loadSound(e.target.result, songLoaded);
                };
                reader.readAsDataURL(file);
            }
        }

        function songLoaded() {
            select('#playButton').show();
        }

        function togglePlay() {
            if (song.isPlaying()) {
                song.pause();
                select('#playButton').html("Play");
            } else {
                song.play();
                select('#playButton').html("Pause");
            }
        }

        class Dancer {
            constructor(x, y, size) {
                this.x = x;
                this.y = y;
                this.size = size;  // Used for the size of the figure (radius of head)
                this.angle = 0;    // Used to rotate limbs
            }

            move() {
                // Sync movement with the song's current time
                let beat = song.currentTime();
                this.x = 200 + Math.sin(this.angle) * 100;  // Circular movement for dancer
                this.y = 200 + Math.cos(this.angle) * 100;
                this.angle += 0.1 + (beat % 2) * 0.02;  // Some randomization based on time
            }

            display() {
                // Draw head
                fill(255, 220, 185);  // Skin tone for head
                ellipse(this.x, this.y - this.size, this.size * 2);  // Head is a circle

                // Draw body
                fill(0);  // Black for body
                rect(this.x - 5, this.y - this.size, 10, this.size * 3);  // Body is a rectangle

                // Draw arms
                line(this.x - 25, this.y - this.size + 20, this.x + 25, this.y - this.size + 20);  // Arms (horizontal line)

                // Draw legs
                line(this.x, this.y + this.size * 2, this.x - 20, this.y + this.size * 4);  // Left leg
                line(this.x, this.y + this.size * 2, this.x + 20, this.y + this.size * 4);  // Right leg
            }
        }

        function keyPressed() {
            if (key === '1') {
                dancers.push(new Dancer(200, 200, 20));
            } else if (key === '2') {
                dancers.push(new Dancer(400, 200, 20));
            }
        }
    </script>
</body>
</html>
