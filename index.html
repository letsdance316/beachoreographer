<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dance Choreography Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="p5.sound.min.js"></script> <!-- Reference to your uploaded file -->
</head>
<body>
    <h1>Dance Choreography Tool</h1>
    <p>Upload a song and choreograph your moves!</p>
    <input type="file" id="fileInput" accept="audio/*">
    <br>
    <button id="playButton">Play</button>
    <canvas id="danceCanvas"></canvas>

    <script>
        let song;
        let dancers = [];
        let playButton;

        function setup() {
            createCanvas(600, 400);
            background(240);
            playButton = select('#playButton');
            playButton.mousePressed(togglePlay);

            let input = document.getElementById('fileInput');
            input.addEventListener('change', handleFileSelect, false);
        }

        function draw() {
            background(240);

            // Draw the dancers
            dancers.forEach(dancer => {
                dancer.display();
                dancer.move();
            });
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    song = loadSound(e.target.result, songLoaded);
                };
                reader.readAsDataURL(file);
            }
        }

        function songLoaded() {
            playButton.show();
        }

        function togglePlay() {
            if (song.isPlaying()) {
                song.pause();
                playButton.html("Play");
            } else {
                song.play();
                playButton.html("Pause");
            }
        }

        class Dancer {
            constructor(x, y, size) {
                this.x = x;
                this.y = y;
                this.size = size;  // Used for the size of the figure (radius of head)
                this.angle = 0;    // Used to rotate limbs
                this.skinColor = color(255, 220, 185);  // Default skin color
                this.clothingColor = color(0, 0, 255);  // Default clothing color (blue)
            }

            move() {
                // Basic walking animation: arms and legs alternate positions
                this.angle += 0.1;
                let beat = song ? song.currentTime() : 0;

                // Change leg and arm positions slightly based on song time for animation
                this.leftLegY = this.y + this.size * 2 + Math.sin(beat * 2) * 20;
                this.rightLegY = this.y + this.size * 2 + Math.cos(beat * 2) * 20;

                this.leftArmX = this.x - Math.cos(beat * 1.5) * 30;
                this.rightArmX = this.x + Math.cos(beat * 1.5) * 30;
            }

            display() {
                // Draw head
                fill(this.skinColor);
                ellipse(this.x, this.y - this.size, this.size * 2);  // Head

                // Draw body
                fill(this.clothingColor);
                rect(this.x - 10, this.y - this.size, 20, this.size * 2);  // Body (shirt)

                // Draw arms
                stroke(0);
                strokeWeight(4);
                line(this.x, this.y - this.size + 10, this.leftArmX, this.y);  // Left arm
                line(this.x, this.y - this.size + 10, this.rightArmX, this.y);  // Right arm

                // Draw legs
                line(this.x, this.y + this.size, this.x - 20, this.leftLegY);  // Left leg
                line(this.x, this.y + this.size, this.x + 20, this.rightLegY);  // Right leg
            }
        }

        function keyPressed() {
            if (key === '1') {
                dancers.push(new Dancer(200, 200, 20));
            } else if (key === '2') {
                dancers.push(new Dancer(400, 200, 20));
            }
        }
    </script>
</body>
</html>
